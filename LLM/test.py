import json

import requests

# Define the URL of the llama.cpp model server (adjust the URL accordingly)
url = "http://localhost:34343/completion"  # Adjust port and path as needed
# Define the request payload
system_promt = """<|user|>
Вы — ИИ-секретарь, работающий исключительно на русском языке и специализирующийся на автоматизации обработки записей совещаний.  
Ваша задача:  
1. Создание точных транскрипций, без добавления лишней информации, с указанием только ключевых тем обсуждений и задач.
2. Распределение задач с указанием только ответственных лиц и сроков выполнения.
3. Формирование структурированных и кратких протоколов, включающих:
   - Список участников и их роли (только тех, кто активно принимал участие).
   - Повестку дня с кратким описанием обсуждаемых вопросов.
   - Задачи с указанием ответственных и сроков.
   - Дополнительные заметки только по сути.
   - Исключайте любые дублирования информации, ошибки или излишние детали.
<|end|>
<|assistant|>
"""
test_data = """
"result": {
    "segments": [
      {
        "start": 1.088,
        "end": 12.716,
        "text": " Вы знаете, что в Государственную Думу у меня вынесено предложение о назначении вас на должность председателя правительства Российской Федерации.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 12.756,
        "end": 20.001,
        "text": "Совсем недавно мы встречались с коллегами и оценивали работу правительства за предыдущие годы.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 20.061,
        "end": 28.807,
        "text": "Сделано в сложных условиях немало, и мне кажется, что было бы правильно, если бы",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 36.504,
        "end": 42.048,
        "text": " Мы с вами говорили и о структуре, говорили о персонале.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 42.088,
        "end": 44.89,
        "text": "В целом, думаю, мы на правильном пути.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 44.95,
        "end": 65.183,
        "text": "И очень надеюсь на то, что депутаты Государственной Думы, а вы не так давно были в Госдуме, отчитывались, они знают, что и как правительство, и вами, как председателям правительства, сделано за последние годы, оценят должным образом и поддержат вас в ходе ваших консультаций предстоящих сегодня в Госдуме.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 94.77,
        "end": 97.152,
        "text": " Спасибо, уважаемый Владимир Владимирович.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 97.192,
        "end": 113.905,
        "text": "Хочу в первую очередь поблагодарить вас за доверие, которое вы оказали мне, за задачи, которые вы поставили перед Федеральным Собранием в своем послании, и, конечно, те национальные цели развития, которые были указаны в новом майском указе.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 114.885,
        "end": 118.468,
        "text": " Это ориентир и приоритеты в работе правительства.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 118.508,
        "end": 121.871,
        "text": "Хочу вас заверить, что никаких пауз в работе правительства не будет.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 121.911,
        "end": 124.593,
        "text": "Мы будем продолжать текущую работу.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 124.613,
        "end": 133.92,
        "text": "Также считаю, что мы должны обеспечить преемственность по всем национальным целям, которые были до этого, 204 и 474 указе.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 133.98,
        "end": 140.025,
        "text": "Сделаем все для развития нашей экономики, чтобы оправдать доверие наших людей.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 140.065,
        "end": 144.208,
        "text": "И уверен, что под вашим руководством мы все задачи, которые поставлены, решим.",
        "speaker": "SPEAKER_00"
      },
      {
        "start": 145.229,
        "end": 151.012,
        "text": " Мы с вами вместе и с коллегами из правительства формулировали национальные цели развития.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 151.093,
        "end": 158.578,
        "text": "Это, конечно, главное, к чему мы должны стремиться, к реализации этих целей по всем направлениям.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 158.658,
        "end": 163.461,
        "text": "И, как показывает практика последних лет, в целом у нас…",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 166.082,
        "end": 171.025,
        "text": " Получается добиваться тех результатов, которые нужны стране.",
        "speaker": "SPEAKER_01"
      },
      {
        "start": 171.105,
        "end": 182.45,
        "text": "А в сегодняшних непростых условиях, конечно, нужно собраться и нужно организовать работу именно так, как мы с вами договорились на последней встрече с правительством, работать без пауз.",
        "speaker": "SPEAKER_01"
      }
    ]
  }
"""
data = {
    "prompt": f"{system_promt} - {test_data}",
    "max_tokens": 2048,  # Limit the number of tokens generated
}

# Set headers for the request
headers = {"Content-Type": "application/json"}

# Send a POST request to the model server
response = requests.post(url, headers=headers, data=json.dumps(data))

# Check if the request was successful
if response.status_code == 200:
    # Get and print the generated text
    result = response.json()
    print("Generated Output:", result["content"])
else:
    print(f"Error: {response.status_code}")
    print(response.text)
